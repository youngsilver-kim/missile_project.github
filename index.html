<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>전주대학교 3D 지도 + 미사일 시뮬레이션</title>
  <style>
    body { margin:0; padding:0; background:linear-gradient(135deg,#667eea,#764ba2); overflow:hidden; }
    #container { position:relative; width:100vw; height:100vh; font-family:Arial,sans-serif; }
    #loading { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); color:#fff; z-index:10; }
    #info-panel {
      position:absolute; top:20px; left:20px;
      width:300px; padding:15px;
      background:rgba(255,255,255,0.9); border-radius:12px;
    }
    #controls {
      position:absolute; top:20px; right:20px;
      width:200px; padding:15px;
      background:rgba(255,255,255,0.9); border-radius:12px;
    }
    .control-group { margin-bottom:10px; }
    .control-group label { display:block; font-weight:bold; margin-bottom:4px; }
    #terrain, #missile-sim { position:absolute; }
    #terrain    { bottom:0; left:0; width:100%; height:60%; }
    #missile-sim{ top:0; right:0; width:50vw; height:50vh; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
</head>
<body>
  <div id="container">
    <div id="loading">3D 지도를 로딩 중…</div>

    <div id="info-panel">
      <h2>전주대학교 3D 지도</h2>
      <p>
        위도: 35.8242° N<br>
        경도: 127.1480° E<br>
        고도: 약 50 m<br>
        주소: 전북 전주시 완산구 천잠로 303
      </p>
    </div>

    <div id="controls">
      <div class="control-group">
        <label for="rotation-speed">회전 속도</label>
        <input type="range" id="rotation-speed" min="0" max="2" step="0.1" value="0.5">
      </div>
      <div class="control-group">
        <label for="zoom-level">줌 레벨</label>
        <input type="range" id="zoom-level" min="0.5" max="2" step="0.1" value="1">
      </div>
      <div class="control-group">
        <label for="tilt-angle">기울기</label>
        <input type="range" id="tilt-angle" min="30" max="80" step="5" value="60">
      </div>
    </div>

    <div id="terrain"></div>
    <div id="missile-sim"></div>
  </div>

  <script>
    // --- JeonjuUniversity3D: 지형 + 건물/도로/산/물 추가 ---
    class JeonjuUniversity3D {
      constructor(id) {
        this.cnv = document.getElementById(id);
        const W = this.cnv.clientWidth, H = this.cnv.clientHeight;
        this.scene = new THREE.Scene();
        this.camera = new THREE.PerspectiveCamera(45, W/H, 1, 1000);
        this.renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
        this.renderer.setSize(W,H);
        this.cnv.appendChild(this.renderer.domElement);

        // 조명
        const light = new THREE.DirectionalLight(0xffffff,1);
        light.position.set(100,200,100);
        this.scene.add(light);

        // 1) 지형
        const geom = new THREE.PlaneGeometry(400,400,80,80);
        geom.rotateX(-Math.PI/2);
        const pos = geom.attributes.position;
        for(let i=0;i<pos.count;i++){
          pos.setY(i, Math.random()*10);
        }
        geom.computeVertexNormals();
        this.scene.add(new THREE.Mesh(geom, new THREE.MeshLambertMaterial({ color:0x8B4513 })));

        // 2) 건물 (회색 박스 + 빨강 원)
        const bGeom = new THREE.BoxGeometry(15,5,10);
        const bMat  = new THREE.MeshLambertMaterial({ color:0x666666 });
        const circleG = new THREE.CircleGeometry(3,32);
        const circleM= new THREE.MeshBasicMaterial({ color:0xff0000 });
        [
          [  50,2.5, 50],
          [  80,2.5, 70],
          [ 110,2.5, 90]
        ].forEach(([x,y,z])=>{
          const b = new THREE.Mesh(bGeom,bMat);
          b.position.set(x,y,z);
          this.scene.add(b);
          const c = new THREE.Mesh(circleG,circleM);
          c.rotateX(-Math.PI/2);
          c.position.set(x,y+3,z);
          this.scene.add(c);
        });

        // 3) 도로
        const roadM = new THREE.LineBasicMaterial({ color:0x000000 });
        const pts1 = [ [-50,0.2,100], [200,0.2,100] ]
                      .map(a=>new THREE.Vector3(...a));
        this.scene.add(new THREE.Line(new THREE.BufferGeometry().setFromPoints(pts1), roadM));
        const pts2 = [ [ 75,0.2,50], [ 75,0.2,150] ]
                      .map(a=>new THREE.Vector3(...a));
        this.scene.add(new THREE.Line(new THREE.BufferGeometry().setFromPoints(pts2), roadM));

        // 4) 산 (초록 삼각뿔)
        const triGeom = new THREE.ConeGeometry(10,15,3);
        const triMat  = new THREE.MeshLambertMaterial({ color:0x228B22 });
        [[150,7.5,120],[180,7.5,140],[210,7.5,160]].forEach(p=>{
          const m=new THREE.Mesh(triGeom,triMat);
          m.position.set(...p);
          m.rotateY(Math.PI/3);
          this.scene.add(m);
        });

        // 5) 물 (파란 원)
        const waterG = new THREE.CircleGeometry(20,32);
        const waterM= new THREE.MeshBasicMaterial({ color:0x0000ff });
        const water = new THREE.Mesh(waterG, waterM);
        water.rotateX(-Math.PI/2);
        water.position.set(-100,0.3,80);
        this.scene.add(water);

        // 슬라이더 초기값
        this.radius       = 250;
        this.rotationSpeed= parseFloat(document.getElementById('rotation-speed').value);
        this.zoom         = parseFloat(document.getElementById('zoom-level').value);
        this.tilt         = parseInt(document.getElementById('tilt-angle').value) * Math.PI/180;

        this.updateCamera();
        this.animate();
      }

      updateCamera() {
        const r = this.radius * this.zoom;
        this.camera.position.set(
          0,
          r * Math.sin(this.tilt),
          r * Math.cos(this.tilt)
        );
        this.camera.lookAt(0,0,0);
        this.camera.updateProjectionMatrix();
      }

      animate() {
        requestAnimationFrame(()=>this.animate());
        this.scene.rotation.y += this.rotationSpeed * 0.005;
        this.renderer.render(this.scene, this.camera);
      }
    }

    // --- MissileSimulation: 기존 코드 그대로 ---
    class MissileSimulation {
      constructor(id) {
        this.cnv = document.getElementById(id);
        const W = this.cnv.clientWidth, H = this.cnv.clientHeight;
        this.scene = new THREE.Scene();
        this.camera = new THREE.PerspectiveCamera(45, W/H, 1, 1000);
        this.camera.position.set(100,100,200);
        this.renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
        this.renderer.setSize(W,H);
        this.cnv.appendChild(this.renderer.domElement);

        const light = new THREE.DirectionalLight(0xffffff,1);
        light.position.set(50,100,100);
        this.scene.add(light);

        // 기지 A
        const base = new THREE.Mesh(
          new THREE.SphereGeometry(3,16,16),
          new THREE.MeshStandardMaterial({ color:0x0000ff })
        );
        base.position.set(50,20,0);
        this.scene.add(base);

        this.computeTrajectories();
        this.animate();
      }

      computeTrajectories() {
        const vI = 120, SA = new THREE.Vector3(50,20,0);
        const PH1= t=> new THREE.Vector3(250-20*t,300-25*t,400-4.9*t*t);
        let tImp=0, minE=Infinity, gT=Math.sqrt(400/4.9);
        for(let t=0;t<=gT;t+=0.01){
          const e=Math.abs(PH1(t).distanceTo(SA)-vI*t);
          if(e<minE){minE=e; tImp=t;}
        }
        const Pimp=PH1(tImp), u=Pimp.clone().sub(SA).normalize();
        this.ePts=[]; this.iPts=[];
        for(let i=0;i<=200;i++){
          const tt=tImp*i/200;
          this.ePts.push(PH1(tt));
          this.iPts.push(SA.clone().add(u.clone().multiplyScalar(vI*tt)));
        }

        this.scene.add(
          new THREE.Line(
            new THREE.BufferGeometry().setFromPoints(this.ePts),
            new THREE.LineBasicMaterial({ color:0xff6600 })
          ),
          new THREE.Line(
            new THREE.BufferGeometry().setFromPoints(this.iPts),
            new THREE.LineBasicMaterial({ color:0x00ffff })
          )
        );

        const dotG=new THREE.SphereGeometry(2,8,8);
        this.eDot=new THREE.Mesh(dotG,new THREE.MeshStandardMaterial({color:0xff0000}));
        this.iDot=new THREE.Mesh(dotG,new THREE.MeshStandardMaterial({color:0x0000ff}));
        this.scene.add(this.eDot,this.iDot);
        this.frame=0; this.max=200;
      }

      animate() {
        requestAnimationFrame(()=>this.animate());
        this.scene.rotation.y += 0.002;
        if(this.frame<this.max){
          this.eDot.position.copy(this.ePts[this.frame]);
          this.iDot.position.copy(this.iPts[this.frame]);
          this.frame++;
        }
        this.renderer.render(this.scene,this.camera);
      }
    }

    // --- 초기화 & 이벤트 바인딩 ---
    document.addEventListener('DOMContentLoaded', ()=>{
      setTimeout(()=>document.getElementById('loading').style.display='none', 2000);
      const map3d = new JeonjuUniversity3D('terrain');
      new MissileSimulation('missile-sim');

      document.getElementById('rotation-speed')
        .addEventListener('input', e=>{ map3d.rotationSpeed = +e.target.value; });
      document.getElementById('zoom-level')
        .addEventListener('input', e=>{ map3d.zoom = +e.target.value; map3d.updateCamera(); });
      document.getElementById('tilt-angle')
        .addEventListener('input', e=>{ map3d.tilt = e.target.value * Math.PI/180; map3d.updateCamera(); });
    });
  </script>
</body>
</html>
